---
import BaseLayout from "../layouts/BaseLayout.astro";
import { SITE } from "../consts";
import { profile } from "../data/profile";
import { talks } from "../data/talks";

const siteUrl = Astro.site ?? new URL(SITE.siteUrl);

const items = talks;

const structuredData = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Person",
      "@id": "#person",
      name: profile.name,
      url: siteUrl.href
    },
    ...items.map((item, index) => {
      if (item.type === "podcast") {
        return {
          "@type": "PodcastEpisode",
          "@id": `#podcast-${index + 1}`,
          name: item.title,
          description: item.description,
          url: item.url
        };
      }
      return {
        "@type": "VideoObject",
        "@id": `#talk-${index + 1}`,
        name: item.title,
        description: item.description,
        url: item.url
      };
    })
  ]
};
---
<BaseLayout
  title="Talks"
  description="Selected talks and presentations by Dr. Noe Lorona."
  structuredData={structuredData}
>
  <header class="mb-4">
    <h1 class="text-3xl font-semibold text-ink">Talks</h1>
  </header>

  <section id="talks" class="py-4">
    <div class="space-y-3">
      {items.map((item) => (
        <article class="rounded-2xl border border-slate/10 bg-haze/80 p-4">
          <h2 class="text-lg font-semibold text-ink">{item.title}</h2>
          {item.description && <p class="mt-2 text-sm text-slate">{item.description}</p>}
          <a class="mt-3 inline-flex text-sm font-semibold text-marigold" href={item.url}>
            {item.url}
          </a>
          <div class="mt-4">
            {item.type === "podcast" ? (
              <iframe
                class="h-40 w-full rounded-xl border border-slate/20"
                src={`https://open.spotify.com/embed/episode/${item.embedId}`}
                title={item.title}
                loading="lazy"
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
              ></iframe>
            ) : (
              <iframe
                class="aspect-video w-full rounded-xl border border-slate/20"
                src={`https://www.youtube.com/embed/${item.embedId}`}
                title={item.title}
                loading="lazy"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
              ></iframe>
            )}
          </div>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
