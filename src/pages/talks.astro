---
import BaseLayout from "../layouts/BaseLayout.astro";
import { SITE } from "../consts";
import { profile } from "../data/profile";

const siteUrl = Astro.site ?? new URL(SITE.siteUrl);

const items = [
  {
    type: "podcast",
    title: "Building Trust and Security in the DoD: A DevSecOps Perspective (Podcast)",
    url: "https://open.spotify.com/episode/268KjisObaCX4WdDUmDbWG?si=aa37280d651741bc",
    embedId: "268KjisObaCX4WdDUmDbWG",
    description: "Defense University podcast episode."
  },
  {
    title:
      "Automating Container Image Promotion Across Environments From Source to Prod - Army Software Factory",
    url: "https://youtu.be/V9zfFRtkFGw?si=mD6cV-g6EE03YH8T",
    embedId: "V9zfFRtkFGw",
    type: "video",
    description:
      "Lightning talk from Chainguard's In Containers We Trust series on promoting container images from source to production."
  },
  {
    title: "My Transition from Platform Engineer to Platform Product Manager - Noe Lorona",
    url: "https://youtu.be/EWN7pw6JqKE?si=ufD2yHPg7rtQxtFB",
    embedId: "EWN7pw6JqKE",
    type: "video",
    description:
      "DevOpsDays 2025 talk on the transition from platform engineering to platform product management and the shift from execution to strategy."
  }
];

const structuredData = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Person",
      "@id": "#person",
      name: profile.name,
      url: siteUrl.href
    },
    ...items.map((item, index) => {
      if (item.type === "podcast") {
        return {
          "@type": "PodcastEpisode",
          "@id": `#podcast-${index + 1}`,
          name: item.title,
          description: item.description,
          url: item.url
        };
      }
      return {
        "@type": "VideoObject",
        "@id": `#talk-${index + 1}`,
        name: item.title,
        description: item.description,
        url: item.url
      };
    })
  ]
};
---
<BaseLayout
  title="Talks"
  description="Selected talks and presentations by Dr. Noe Lorona."
  structuredData={structuredData}
>
  <header class="mb-4">
    <h1 class="text-3xl font-semibold text-ink">Talks</h1>
  </header>

  <section id="talks" class="py-4">
    <div class="space-y-3">
      {items.map((item) => (
        <article class="rounded-2xl border border-slate/10 bg-haze/80 p-4">
          <h2 class="text-lg font-semibold text-ink">{item.title}</h2>
          {item.description && <p class="mt-2 text-sm text-slate">{item.description}</p>}
          <a class="mt-3 inline-flex text-sm font-semibold text-marigold" href={item.url}>
            {item.url}
          </a>
          <div class="mt-4">
            {item.type === "podcast" ? (
              <iframe
                class="h-40 w-full rounded-xl border border-slate/20"
                src={`https://open.spotify.com/embed/episode/${item.embedId}`}
                title={item.title}
                loading="lazy"
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
              ></iframe>
            ) : (
              <iframe
                class="aspect-video w-full rounded-xl border border-slate/20"
                src={`https://www.youtube.com/embed/${item.embedId}`}
                title={item.title}
                loading="lazy"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
              ></iframe>
            )}
          </div>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
