---
import BaseLayout from "../layouts/BaseLayout.astro";
import { SITE } from "../consts";
import { profile } from "../data/profile";
import { publications } from "../data/publications";

const siteUrl = Astro.site ?? new URL(SITE.siteUrl);

const publicationEntries = publications.map((item, index) => ({
  "@type": "ScholarlyArticle",
  "@id": `#publication-${index + 1}`,
  name: item.title,
  author: {
    "@type": "Person",
    name: profile.name
  },
  url: item.externalUrl ?? item.link
}));

const structuredData = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Person",
      "@id": "#person",
      name: profile.name,
      url: siteUrl.href,
      sameAs: [profile.publications.scholarUrl]
    },
    ...publicationEntries
  ]
};

const timeline = publications;
---
<BaseLayout
  title="Publications"
  description="Selected publications and scholarly contributions for Dr. Noe Lorona."
  structuredData={structuredData}
>

    <div class="space-y-6">
      <section class="rounded-2xl border border-slate/10 bg-haze/80 p-6">
        <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {timeline.map((publication) => (
            <article class="flex h-full flex-col rounded-xl border border-slate/20 p-4">
              <h4 class="text-sm leading-snug">
                <span class="font-bold text-marigold">{publication.title}</span>
                <span class="text-slate">
                  {" "}
                  â€” {publication.summary || `${publication.category}.`}
                </span>
              </h4>
              {(publication.externalUrl || publication.pdfUrl) && (
                <div class="mt-3 flex flex-wrap items-start gap-2 text-sm">
                  {(() => {
                    const isDissertation =
                      publication.title ===
                      'Strategies Employed by Project Managers when Adopting Agile DevSecOps to Manage Software Development in the DoD';
                    const isMediumArticle =
                      publication.title ===
                        'The Ever-Rising Horizon: A Modern Take on the Dunning-Kruger Curve for T-Shaped Engineers' ||
                      publication.title === 'Lean Platform Engineering' ||
                      publication.title === 'The Lean Startup Explained';
                    const isWritingArticle =
                      publication.title ===
                      'Tips and Techniques for Accelerating Your Writing';
                    const isLineOfDeparture =
                      publication.title === 'Call to Action: There Has To Be a Better Way';
                    const isSignalOpsArticle =
                      publication.title === 'Agile and Anti-Agile in Signal Operations';
                    const isMilitaryAcademiaArticle =
                      publication.title ===
                      'A Journey in Military Academia: Breaking Down Barriers to Writing';
                    const isExploringArticle =
                      publication.title ===
                      'Exploring Enabling Technologies in Military Agile Development';
                    const isFossArticle =
                      publication.title === 'The power of FOSS';
                    const externalLabel = isDissertation
                      ? 'Go to academia.edu'
                      : isMediumArticle
                        ? 'medium.com'
                        : isWritingArticle
                          ? 'Go to article'
                          : isLineOfDeparture
                            ? 'Go to lineofdeparture.army.mil'
                            : isSignalOpsArticle
                              ? 'Go to article'
                              : isMilitaryAcademiaArticle
                                ? 'Go to article'
                                : isExploringArticle
                                  ? 'Go to article'
                                  : isFossArticle
                                    ? 'Go to article'
                                  : 'Go to publication';
                    const downloadLabel = isDissertation
                      ? 'Download dissertation'
                      : isWritingArticle
                        ? 'Download article'
                        : isLineOfDeparture
                          ? 'Download article'
                        : isSignalOpsArticle
                          ? 'Download article'
                          : isMilitaryAcademiaArticle
                            ? 'Download article'
                            : isExploringArticle
                              ? 'Download article'
                              : isFossArticle
                                ? 'Download article'
                              : 'Download publication';
                    return (
                      <>
                        {publication.externalUrl && (
                          <a
                            class="inline-flex items-center rounded-full border border-slate/30 px-3 py-1 font-semibold text-ink transition hover:border-marigold hover:bg-marigold/20 hover:text-ink/95"
                            href={publication.externalUrl}
                          >
                            {externalLabel}
                          </a>
                        )}
                        {publication.pdfUrl && (
                          <a
                            class="inline-flex items-center rounded-full border border-slate/30 px-3 py-1 font-semibold text-ink transition hover:border-marigold hover:bg-marigold/20 hover:text-ink/95"
                            href={publication.pdfUrl}
                            download
                          >
                            {downloadLabel}
                          </a>
                        )}
                      </>
                    );
                  })()}
                </div>
              )}
            </article>
          ))}
        </div>
      </section>
    </div>
  </section>
</BaseLayout>
